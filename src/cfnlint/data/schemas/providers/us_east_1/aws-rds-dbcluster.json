{
 "additionalProperties": false,
 "cfnLint": [
  "AWS::RDS::DBCluster/Properties"
 ],
 "conditionalCreateOnlyProperties": [
  "/properties/Engine",
  "/properties/GlobalClusterIdentifier",
  "/properties/MasterUsername"
 ],
 "createOnlyProperties": [
  "/properties/AvailabilityZones",
  "/properties/DBClusterIdentifier",
  "/properties/DBSubnetGroupName",
  "/properties/DBSystemId",
  "/properties/DatabaseName",
  "/properties/EngineMode",
  "/properties/KmsKeyId",
  "/properties/PubliclyAccessible",
  "/properties/RestoreToTime",
  "/properties/RestoreType",
  "/properties/SnapshotIdentifier",
  "/properties/SourceDBClusterIdentifier",
  "/properties/SourceRegion",
  "/properties/StorageEncrypted",
  "/properties/UseLatestRestorableTime"
 ],
 "definitions": {
  "DBClusterRole": {
   "additionalProperties": false,
   "properties": {
    "FeatureName": {
     "type": "string"
    },
    "RoleArn": {
     "type": "string"
    }
   },
   "required": [
    "RoleArn"
   ],
   "type": "object"
  },
  "Endpoint": {
   "additionalProperties": false,
   "properties": {
    "Address": {
     "type": "string"
    },
    "Port": {
     "type": "string"
    }
   },
   "type": "object"
  },
  "MasterUserSecret": {
   "additionalProperties": false,
   "properties": {
    "KmsKeyId": {
     "type": "string"
    },
    "SecretArn": {
     "type": "string"
    }
   },
   "type": "object"
  },
  "ReadEndpoint": {
   "additionalProperties": false,
   "properties": {
    "Address": {
     "type": "string"
    }
   },
   "type": "object"
  },
  "ScalingConfiguration": {
   "additionalProperties": false,
   "properties": {
    "AutoPause": {
     "type": "boolean"
    },
    "MaxCapacity": {
     "type": "integer"
    },
    "MinCapacity": {
     "type": "integer"
    },
    "SecondsBeforeTimeout": {
     "type": "integer"
    },
    "SecondsUntilAutoPause": {
     "type": "integer"
    },
    "TimeoutAction": {
     "type": "string"
    }
   },
   "type": "object"
  },
  "ServerlessV2ScalingConfiguration": {
   "additionalProperties": false,
   "properties": {
    "MaxCapacity": {
     "type": "number"
    },
    "MinCapacity": {
     "type": "number"
    }
   },
   "type": "object"
  },
  "Tag": {
   "additionalProperties": false,
   "properties": {
    "Key": {
     "maxLength": 128,
     "minLength": 1,
     "type": "string"
    },
    "Value": {
     "maxLength": 256,
     "minLength": 0,
     "type": "string"
    }
   },
   "required": [
    "Key"
   ],
   "type": "object"
  }
 },
 "dependentExcluded": {
  "SnapshotIdentifier": [
   "MasterUsername",
   "MasterUserPassword"
  ],
  "SourceDBClusterIdentifier": [
   "MasterUsername",
   "MasterUserPassword",
   "StorageEncrypted"
  ]
 },
 "handlers": {
  "create": {
   "permissions": [
    "iam:CreateServiceLinkedRole",
    "iam:PassRole",
    "rds:AddRoleToDBCluster",
    "rds:AddTagsToResource",
    "rds:CreateDBCluster",
    "rds:CreateDBInstance",
    "rds:DescribeDBClusters",
    "rds:DescribeEvents",
    "rds:EnableHttpEndpoint",
    "rds:ModifyDBCluster",
    "rds:RestoreDBClusterFromSnapshot",
    "rds:RestoreDBClusterToPointInTime",
    "secretsmanager:CreateSecret",
    "secretsmanager:TagResource"
   ],
   "timeoutInMinutes": 2160
  },
  "delete": {
   "permissions": [
    "rds:CreateDBClusterSnapshot",
    "rds:DeleteDBCluster",
    "rds:DeleteDBInstance",
    "rds:DescribeDBClusters",
    "rds:DescribeGlobalClusters",
    "rds:RemoveFromGlobalCluster"
   ]
  },
  "list": {
   "permissions": [
    "rds:DescribeDBClusters"
   ]
  },
  "read": {
   "permissions": [
    "rds:DescribeDBClusters"
   ]
  },
  "update": {
   "permissions": [
    "ec2:DescribeSecurityGroups",
    "iam:PassRole",
    "rds:AddRoleToDBCluster",
    "rds:AddTagsToResource",
    "rds:DescribeDBClusters",
    "rds:DescribeDBSubnetGroups",
    "rds:DescribeEvents",
    "rds:DescribeGlobalClusters",
    "rds:DisableHttpEndpoint",
    "rds:EnableHttpEndpoint",
    "rds:ModifyDBCluster",
    "rds:ModifyDBInstance",
    "rds:RemoveFromGlobalCluster",
    "rds:RemoveRoleFromDBCluster",
    "rds:RemoveTagsFromResource",
    "secretsmanager:CreateSecret",
    "secretsmanager:TagResource"
   ],
   "timeoutInMinutes": 2160
  }
 },
 "primaryIdentifier": [
  "/properties/DBClusterIdentifier"
 ],
 "properties": {
  "AllocatedStorage": {
   "type": "integer"
  },
  "AssociatedRoles": {
   "items": {
    "$ref": "#/definitions/DBClusterRole"
   },
   "type": "array",
   "uniqueItems": true
  },
  "AutoMinorVersionUpgrade": {
   "type": "boolean"
  },
  "AvailabilityZones": {
   "cfnLint": [
    "AWS::RDS::DBCluster/Properties/AvailabilityZones"
   ],
   "items": {
    "type": "string"
   },
   "type": "array",
   "uniqueItems": true
  },
  "BacktrackWindow": {
   "default": 0,
   "minimum": 0,
   "type": "integer"
  },
  "BackupRetentionPeriod": {
   "default": 1,
   "maximum": 35,
   "minimum": 1,
   "type": "integer"
  },
  "CopyTagsToSnapshot": {
   "type": "boolean"
  },
  "DBClusterArn": {
   "type": "string"
  },
  "DBClusterIdentifier": {
   "maxLength": 63,
   "minLength": 1,
   "pattern": "^[a-zA-Z]{1}(?:-?[a-zA-Z0-9]){0,62}$",
   "type": "string"
  },
  "DBClusterInstanceClass": {
   "type": "string"
  },
  "DBClusterParameterGroupName": {
   "default": "default.aurora5.6",
   "type": "string"
  },
  "DBClusterResourceId": {
   "type": "string"
  },
  "DBInstanceParameterGroupName": {
   "type": "string"
  },
  "DBSubnetGroupName": {
   "type": "string"
  },
  "DBSystemId": {
   "type": "string"
  },
  "DatabaseName": {
   "type": "string"
  },
  "DeletionProtection": {
   "type": "boolean"
  },
  "Domain": {
   "type": "string"
  },
  "DomainIAMRoleName": {
   "type": "string"
  },
  "EnableCloudwatchLogsExports": {
   "items": {
    "type": "string"
   },
   "type": "array",
   "uniqueItems": true
  },
  "EnableGlobalWriteForwarding": {
   "type": "boolean"
  },
  "EnableHttpEndpoint": {
   "type": "boolean"
  },
  "EnableIAMDatabaseAuthentication": {
   "type": "boolean"
  },
  "Endpoint": {
   "$ref": "#/definitions/Endpoint"
  },
  "Engine": {
   "type": "string"
  },
  "EngineMode": {
   "type": "string"
  },
  "EngineVersion": {
   "type": "string"
  },
  "GlobalClusterIdentifier": {
   "maxLength": 63,
   "minLength": 0,
   "pattern": "^$|^[a-zA-Z]{1}(?:-?[a-zA-Z0-9]){0,62}$",
   "type": "string"
  },
  "Iops": {
   "type": "integer"
  },
  "KmsKeyId": {
   "type": "string"
  },
  "ManageMasterUserPassword": {
   "type": "boolean"
  },
  "MasterUserPassword": {
   "type": "string"
  },
  "MasterUserSecret": {
   "$ref": "#/definitions/MasterUserSecret"
  },
  "MasterUsername": {
   "minLength": 1,
   "pattern": "^[a-zA-Z]{1}[a-zA-Z0-9_]*$",
   "type": "string"
  },
  "MonitoringInterval": {
   "default": 0,
   "type": "integer"
  },
  "MonitoringRoleArn": {
   "type": "string"
  },
  "NetworkType": {
   "type": "string"
  },
  "PerformanceInsightsEnabled": {
   "type": "boolean"
  },
  "PerformanceInsightsKmsKeyId": {
   "type": "string"
  },
  "PerformanceInsightsRetentionPeriod": {
   "type": "integer"
  },
  "Port": {
   "type": "integer"
  },
  "PreferredBackupWindow": {
   "type": "string"
  },
  "PreferredMaintenanceWindow": {
   "type": "string"
  },
  "PubliclyAccessible": {
   "type": "boolean"
  },
  "ReadEndpoint": {
   "$ref": "#/definitions/ReadEndpoint"
  },
  "ReplicationSourceIdentifier": {
   "type": "string"
  },
  "RestoreToTime": {
   "type": "string"
  },
  "RestoreType": {
   "default": "full-copy",
   "type": "string"
  },
  "ScalingConfiguration": {
   "$ref": "#/definitions/ScalingConfiguration"
  },
  "ServerlessV2ScalingConfiguration": {
   "$ref": "#/definitions/ServerlessV2ScalingConfiguration"
  },
  "SnapshotIdentifier": {
   "type": "string"
  },
  "SourceDBClusterIdentifier": {
   "type": "string"
  },
  "SourceRegion": {
   "type": "string"
  },
  "StorageEncrypted": {
   "type": "boolean"
  },
  "StorageThroughput": {
   "type": "integer"
  },
  "StorageType": {
   "type": "string"
  },
  "Tags": {
   "insertionOrder": false,
   "items": {
    "$ref": "#/definitions/Tag"
   },
   "maxItems": 50,
   "type": "array",
   "uniqueItems": true
  },
  "UseLatestRestorableTime": {
   "type": "boolean"
  },
  "VpcSecurityGroupIds": {
   "items": {
    "type": "string"
   },
   "type": "array",
   "uniqueItems": true
  }
 },
 "propertyTransform": {
  "/properties/DBClusterIdentifier": "$lowercase(DBClusterIdentifier)",
  "/properties/DBClusterParameterGroupName": "$lowercase(DBClusterParameterGroupName)",
  "/properties/DBSubnetGroupName": "$lowercase(DBSubnetGroupName)",
  "/properties/EnableHttpEndpoint": "$lowercase($string(EngineMode)) = 'serverless' ? EnableHttpEndpoint : ($lowercase($string(Engine)) = 'aurora-postgresql' ? EnableHttpEndpoint : false )",
  "/properties/Engine": "$lowercase(Engine)",
  "/properties/EngineVersion": "$join([$string(EngineVersion), \".*\"])",
  "/properties/KmsKeyId": "$join([\"arn:(aws)[-]{0,1}[a-z]{0,2}[-]{0,1}[a-z]{0,3}:kms:[a-z]{2}[-]{1}[a-z]{3,10}[-]{0,1}[a-z]{0,10}[-]{1}[1-3]{1}:[0-9]{12}[:]{1}key\\/\", KmsKeyId])",
  "/properties/MasterUserSecret/KmsKeyId": "$join([\"arn:(aws)[-]{0,1}[a-z]{0,2}[-]{0,1}[a-z]{0,3}:kms:[a-z]{2}[-]{1}[a-z]{3,10}[-]{0,1}[a-z]{0,10}[-]{1}[1-3]{1}:[0-9]{12}[:]{1}key\\/\", MasterUserSecret.KmsKeyId])",
  "/properties/NetworkType": "$lowercase(NetworkType)",
  "/properties/PerformanceInsightsKmsKeyId": "$join([\"arn:(aws)[-]{0,1}[a-z]{0,2}[-]{0,1}[a-z]{0,3}:kms:[a-z]{2}[-]{1}[a-z]{3,10}[-]{0,1}[a-z]{0,10}[-]{1}[1-3]{1}:[0-9]{12}[:]{1}key\\/\", PerformanceInsightsKmsKeyId])",
  "/properties/PreferredMaintenanceWindow": "$lowercase(PreferredMaintenanceWindow)",
  "/properties/SnapshotIdentifier": "$lowercase(SnapshotIdentifier)",
  "/properties/SourceDBClusterIdentifier": "$lowercase(SourceDBClusterIdentifier)",
  "/properties/StorageType": "$lowercase(StorageType)"
 },
 "readOnlyProperties": [
  "/properties/DBClusterArn",
  "/properties/DBClusterResourceId",
  "/properties/Endpoint",
  "/properties/Endpoint/Address",
  "/properties/Endpoint/Port",
  "/properties/ReadEndpoint/Address",
  "/properties/MasterUserSecret/SecretArn",
  "/properties/StorageThroughput"
 ],
 "sourceUrl": "https://github.com/aws-cloudformation/aws-cloudformation-resource-providers-rds",
 "typeName": "AWS::RDS::DBCluster",
 "writeOnlyProperties": [
  "/properties/DBInstanceParameterGroupName",
  "/properties/MasterUserPassword",
  "/properties/RestoreToTime",
  "/properties/RestoreType",
  "/properties/SnapshotIdentifier",
  "/properties/SourceDBClusterIdentifier",
  "/properties/SourceRegion",
  "/properties/UseLatestRestorableTime"
 ]
}
